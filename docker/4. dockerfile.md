# Dockerfile

## Постраение Image <hr>
<br>
Пример dockerfile:
<br>
<br>

```dockerfile
FROM node:14-alpine as build    # Базовый Image 
WORKDIR /opt/app    # Установка рабочий директории
ADD *.json ./   # Добавление файла
RUN npm install
RUN npm i webpack   # Выполнение команды
ADD . .
RUN npm run build api
RUN npm prune --production
CMD [ "node", "./distr/apps/api/main.js" ]  # Команды при запуске

# Каждая строка == новый слой в нашем image
```
<br>

> Чем больше строк в dockerfile, тем больше слоев в Image, который в финале будет строится. Поэтому важно оптимизировать наш dockerfile.

<br><br>

## Контекст<hr>
<br>

> Контекст - это текущая директория, в которой мы выполняем `docker build` со всеми вложеными 
> директориями.
>
> Из контекста можно удалять командой `.dockerignore`, чтобы лишние файлы не попадали в контексть.

```dockerfile
ARG # Заданный аргумент (аргументы используются только во время билда)

FROM # Базовый образ 

as # Алиас

LABEL # Мета информация, которая останется в финальном image, и её можно будет посмотреть

USER и WORKDIR # Настройка юзера и директории в которой будут выполняться последующие команды

ADD # Добавление файлов в образ (Данная команда умеет згружать файлы по URL, работать с правами и архивами)

COPY # Умеет копировать файлы при мульти стайдж билде

SHELL ["/bin/sh", "-c"] # Выбрать shell

RUN echo hello # Выполнение команды shell

ENV # Переменные окружения

VOLUME ["/data"] # Создание volume на host машине

ENTRYPOINT # Команды запуска
CMD # Команды запуска

STOPSIGNAL # Подает сигнал при остановке контейнера

EXPOSE # Указание порта, на котором слушать запросы
```

